- title 'Artikel mit externer Datenbank synchronisieren'

= form_tag update_synchronized_supplier_articles_path(@supplier) do
  %h2 Auslisten ...
  %p
  - unless @outlisted_articles.empty?
    Folgende Artikel wurden ausgelistet und werden 
    %b gelöscht:
    %ul
      - for article in @outlisted_articles
        %li
          = hidden_field_tag "outlisted_articles[#{article.id}]", '1'
          = article.name
          - if article.in_open_order
            .alert
              Achtung, #{article.name} wird gerade in einer laufenden Bestellung verwendet. Bitte erst Bestellung anpassen.
  - else
    %i Es müssen keine Artikel gelöscht werden.
  %hr/
  %h2 Aktualisieren ...
  %p
    %i
      %b= @updated_articles.size
      Artikel müssen aktualisiert werden:
  %p
    %i
      Jeder Artikel wird doppelt angezeigt. Die alten Werte sind grau und die Textfelder sind mit den aktuellen
      Werten vorausgefüllt.
      %br/
      Abweichungen zu den alten Artikeln sind gelb markiert.
    %table.table
      %thead
        %tr
          %th Name
          %th Notiz
          %th Hersteller
          %th Herkunft
          %th Einheit
          %th GebGr
          %th Preis
          %th MwSt.
          %th Pfand
          %th Kategorie
      %tbody
        - @updated_articles.each do |updated_article, attrs|
          - article = Article.find(updated_article.id)
          %tr{:style => 'color:grey'}
            %td= article.name
            %td= article.note
            %td= article.manufacturer
            %td= article.origin
            %td= article.unit
            %td= article.unit_quantity
            %td= article.price
            %td= article.tax
            %td= article.deposit
            %td= article.article_category.name if article.article_category
          %tr
            = fields_for 'articles[]', updated_article do |form|
              %td{:style => highlight_new(attrs, :name)}
                = form.text_field 'name', :size => 0
                = form.hidden_field 'shared_updated_on'
              %td{:style => highlight_new(attrs, :note)}= form.text_field 'note', class: 'input-small'
              %td{:style => highlight_new(attrs, :manufacturer)}= form.text_field 'manufacturer', class: 'input-small'
              %td{:style => highlight_new(attrs, :origin)}= form.text_field 'origin', class: 'input-mini'
              %td{:style => highlight_new(attrs, :unit)}= form.text_field 'unit', class: 'input-mini'
              %td{:style => highlight_new(attrs, :unit_quantity)}= form.text_field 'unit_quantity', class: 'input-mini'
              %td{:style => highlight_new(attrs, :price)}= form.text_field 'price', class: 'input-mini'
              %td{:style => highlight_new(attrs, :tax)}= form.text_field 'tax', class: 'input-mini'
              %td{:style => highlight_new(attrs, :deposit)}= form.text_field 'deposit', class: 'input-mini'
              %td= form.select :article_category_id, ArticleCategory.all.map {|a| [ a.name, a.id ] },
                {include_blank: true}, class: 'input-small'
  %hr/
  = hidden_field 'supplier', 'id'
  = submit_tag 'Alle löschen/aktualisieren', class: 'btn btn-primary'
  = link_to 'oder abbrechen', supplier_articles_path(@supplier)